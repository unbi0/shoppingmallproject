<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <link rel="stylesheet" href="register.css">
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script>
        function daumPost() {
            new daum.Postcode({
                oncomplete: function(data) {
                    let addr = ''; // 주소 변수
                    if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
                        addr = data.roadAddress;
                    } else { // 사용자가 지번 주소를 선택했을 경우(J)
                        addr = data.jibunAddress;
                    }
                    document.getElementById('postcode').value = data.zonecode;
                    document.getElementById('address').value = addr;
                    document.getElementById('detailAddress').focus();
                }
            }).open();
        }

        function handleSubmit(event) {
            event.preventDefault();

            const password = document.getElementById('cipherPassword').value;
            const confirmPassword = document.getElementById('confirm').value;

            if (password !== confirmPassword) {
                alert('비밀번호가 일치하지 않습니다.');
                return;
            }

            const data = {
                email: document.getElementById('email').value,
                password: password,
                username: document.getElementById('username').value,
                postcode: document.getElementById('postcode').value,
                address: document.getElementById('address').value,
                detailAddress: document.getElementById('detailAddress').value
            };

            fetch('/sign-up', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => {
                    if (response.ok) {
                        alert('회원가입이 완료되었습니다.');
                    } else {
                        alert('회원가입에 실패하였습니다.');
                    }
                });
        }
    </script>
</head>
<body>
<div class="container">
    <h1>회원가입</h1>
    <form id="signupForm" onsubmit="handleSubmit(event)">
        <div class="form-group">
            <input type="email" id="email" name="email" placeholder="이메일" required>
        </div>
        <div class="form-group">
            <input type="password" id="cipherPassword" name="cipherPassword" placeholder="비밀번호" required>
        </div>
        <div class="form-group">
            <input type="password" id="confirm" name="confirm" placeholder="비밀번호 확인" required>
        </div>
        <div class="form-group">
            <input type="text" id="username" name="username" placeholder="이름" required>
        </div>
        <div class="form-group postcode-group">
            <input type="text" id="postcode" name="postcode" placeholder="우편번호" readonly="readonly">
            <input type="button" onclick="daumPost()" value="주소 찾기">
        </div>
        <div class="form-group">
            <input type="text" id="address" name="address" placeholder="기본 주소">
        </div>
        <div class="form-group">
            <input type="text" id="detailAddress" name="detailAddress" placeholder="상세 주소">
        </div>
        <div class="button-group">
            <button type="submit">회원 가입</button>
            <button type="button" onclick="location.href='/index.html'">가입 취소</button>
        </div>
    </form>
</div>
</body>
</html>
